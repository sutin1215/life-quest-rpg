<div align="center">

# âš”ï¸ LifeQuest RPG

### *Gamifying Real Life â€” One Quest at a Time*
**KitaHack 2026 â€” SDG 3: Good Health and Well-being**

> A mobile RPG where your real-life tasks become epic quests, powered by Google Gemini AI.  
> Complete assignments. Defeat bosses. Level up â€” in the game and in life.

</div>

---

## ğŸ“– Table of Contents

1. [Project Overview](#-project-overview)
2. [Key Features](#-key-features)
3. [Technology Stack](#-technology-stack)
4. [Technical Architecture](#-technical-architecture)
5. [Implementation Details & Innovation](#-implementation-details--innovation)
6. [AI Integration Deep Dive](#-ai-integration-deep-dive)
7. [Installation & Setup](#-installation--setup)
8. [Firebase Configuration](#-firebase-configuration)
9. [Gemini API Configuration](#-gemini-api-configuration)
10. [Project Structure](#-project-structure)
11. [Challenges Faced](#-challenges-faced)
12. [Future Roadmap](#-future-roadmap)
13. [Team](#-team)

---

## ğŸ® Project Overview

### The Problem

Young adults â€” particularly university students and early-career professionals aged 18â€“30 â€” face a growing motivation crisis. Traditional productivity tools (to-do lists, habit trackers, calendars) are transactional and emotionally flat. They treat tasks as obligations, not opportunities for growth. The result: users abandon these apps within days.

According to the 2023 National Health and Morbidity Survey, **1 in 5 Malaysians** aged 16 and above experience mental health issues, with poor motivation and self-regulation being the most commonly cited contributing factors.

### The Solution

**LifeQuest RPG** reframes real-world tasks as epic RPG quests. Your to-do list becomes a quest board. Your personal growth becomes stat progression. Your procrastination becomes a monster to defeat.

Every element of the experience is **uniquely generated by Google Gemini AI** based on who you are â€” your background, goals, and strengths. No two players have the same character, story, or quest list.

### SDG Alignment

**Primary: SDG 3.4** â€” Promote mental health and well-being through prevention and treatment.  
LifeQuest addresses the motivational and behavioural foundations of mental wellness by making self-improvement feel meaningful, personal, and rewarding.

---

## âœ¨ Key Features

| Feature | Description |
|---|---|
| ğŸ§™ **AI Character Creation** | Gemini generates your unique RPG class, origin story, and stat allocation from your personal bio |
| ğŸ“œ **AI Quest Generation** | Type any real-world task in plain English â†’ Gemini converts it into a lore-flavored RPG quest |
| ğŸ—ºï¸ **World Map & Zones** | 4 unlockable zones (Slime Forest â†’ Goblin Cave â†’ Haunted Keep â†’ Dragon Peak) gated by player level |
| âš”ï¸ **Boss Battles** | Turn-based combat with Attack / Heal / Ultimate actions; AI narrates every moment |
| ğŸ’¬ **Dialogue-Gated Battles** | Boss dialogue must fully animate before player can act â€” genuine RPG conversation pacing |
| ğŸ° **Guildmaster Guidance** | AI generates 3 personalized daily quests based on your full player profile |
| ğŸ›’ **Goblin Market Shop** | Spend earned gold to permanently upgrade STR, INT, or DEX stats |
| ğŸ­ **Pixel Boss Art** | Custom-painted pixel art for each boss (Giant Slime, Goblin King, Skeleton Lord, Red Dragon) |
| ğŸŒŸ **Floating Rewards** | Animated +XP and +Gold popups on quest completion |
| ğŸ“Š **Stat Progression** | Three stats (STR / INT / DEX) that grow with quest completions and shop purchases |
| ğŸ† **Level-Up Celebrations** | Full-screen confetti + dialog on level up |
| ğŸ¨ **Zone Backgrounds** | Hand-painted `CustomPainter` backgrounds unique to each battle zone |

---

## ğŸ›  Technology Stack

### Google Technologies

| Technology | Role | Why Chosen |
|---|---|---|
| **Flutter** | Cross-platform mobile frontend | Single codebase for Android + iOS; powerful animation APIs essential for RPG visual identity |
| **Firebase Auth** | Anonymous user authentication | Zero-friction onboarding â€” no account required; unique UID persists across sessions |
| **Cloud Firestore** | Real-time NoSQL database | Reactive `StreamBuilder` integration with Flutter; offline persistence; serverless auto-scaling |
| **Gemini 2.5 Flash** | Structured AI generation (JSON) | Superior JSON mode reliability; strong reasoning for stat logic; 1,500 req/day free tier |
| **Gemini 2.5 Flash Lite** | Real-time battle narration | Lower latency for mid-gameplay calls; cost-efficient for high-frequency requests |
| **Google AI Studio** | API key management & usage monitoring | Dashboard visibility into per-model API call volumes |

### Supporting Libraries

| Library | Version | Purpose |
|---|---|---|
| `google_generative_ai` | ^0.4.6 | Official Dart SDK for Gemini API access |
| `cloud_firestore` | ^6.1.2 | Firestore client with real-time streams |
| `firebase_auth` | ^6.1.4 | Anonymous authentication |
| `firebase_core` | ^4.4.0 | Firebase initialization |
| `google_fonts` | ^6.2.1 | VT323 pixel font for RPG aesthetic |
| `confetti` | ^0.8.0 | Victory confetti animation |
| `flutter_dotenv` | ^5.2.1 | Secure `.env` file loading for API keys |

---

## ğŸ— Technical Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FLUTTER CLIENT (Dart)                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Screens â”‚  â”‚ Widgets  â”‚  â”‚ Services â”‚  â”‚    Theme     â”‚   â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚              â”‚   â”‚
â”‚  â”‚ splash   â”‚  â”‚dialogue  â”‚  â”‚AiService â”‚  â”‚  RpgTheme    â”‚   â”‚
â”‚  â”‚ home     â”‚  â”‚  box     â”‚  â”‚          â”‚  â”‚  Colors      â”‚   â”‚
â”‚  â”‚ battle   â”‚  â”‚boss      â”‚  â”‚Database  â”‚  â”‚  Styles      â”‚   â”‚
â”‚  â”‚ world mapâ”‚  â”‚painter   â”‚  â”‚Service   â”‚  â”‚  Decorations â”‚   â”‚
â”‚  â”‚ shop     â”‚  â”‚floating  â”‚  â”‚          â”‚  â”‚              â”‚   â”‚
â”‚  â”‚ profile  â”‚  â”‚reward    â”‚  â”‚          â”‚  â”‚              â”‚   â”‚
â”‚  â”‚ char     â”‚  â”‚glowing   â”‚  â”‚          â”‚  â”‚              â”‚   â”‚
â”‚  â”‚ creation â”‚  â”‚stat badgeâ”‚  â”‚          â”‚  â”‚              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   FIREBASE    â”‚    â”‚    GEMINI API       â”‚
          â”‚               â”‚    â”‚                     â”‚
          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
          â”‚ â”‚Firestore  â”‚ â”‚    â”‚ â”‚gemini-2.5-flash â”‚ â”‚
          â”‚ â”‚           â”‚ â”‚    â”‚ â”‚(JSON generation)â”‚ â”‚
          â”‚ â”‚users/     â”‚ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
          â”‚ â”‚  {uid}/   â”‚ â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
          â”‚ â”‚  quests/  â”‚ â”‚    â”‚ â”‚gemini-2.5-flash â”‚ â”‚
          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â”‚-lite (narration)â”‚ â”‚
          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
          â”‚ â”‚Firebase   â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ â”‚Auth       â”‚ â”‚
          â”‚ â”‚(Anonymous)â”‚ â”‚
          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Model (Firestore)

```
users/                          â† collection
  {uid}/                        â† document (one per anonymous user)
    className: "Iron Scholar"
    story: "Origin story..."
    mainQuest: "Graduate with first class honours"
    bio: "Engineering student..."
    level: 3
    xp: 150
    gold: 240
    str: 6
    int: 8
    dex: 5
    currentZone: 1
    createdAt: Timestamp
    
    quests/                     â† subcollection
      {questId}/                â† document
        title: "Slay the Scrolls of Calculus"
        description: "Vanquish the ancient theorems..."
        xp: 50
        gold: 25
        statType: "INT"
        isCompleted: false
        createdAt: Timestamp
```

### Solution Flow

```
App Launch
    â”‚
    â–¼
SplashScreen (3.2s animated)
    â”‚
    â–¼
Firebase Anonymous Auth
    â”‚
    â”œâ”€â”€â”€ New User â”€â”€â–º CharacterCreationScreen
    â”‚                       â”‚
    â”‚                 [Bio + Main Quest input]
    â”‚                       â”‚
    â”‚               Gemini generateCharacter()
    â”‚                       â”‚
    â”‚               Firestore: initializeUser()
    â”‚                       â”‚
    â”‚                 ProfileScreen
    â”‚                       â”‚
    â”‚               Gemini generateStarterQuests()
    â”‚                       â”‚
    â”‚               Firestore: addQuests()
    â”‚                       â”‚
    â””â”€â”€â”€ Existing User â”€â”€â”€â”€â”€â”¤
                            â”‚
                            â–¼
                      HomeScreen (bottom nav)
                      â”œâ”€â”€ QuestBoard (Quests tab)
                      â”‚     â”œâ”€â”€ [+] Add Quest â†’ Gemini generateQuest()
                      â”‚     â”œâ”€â”€ Guildmaster â†’ Gemini generateGuildmasterQuests()
                      â”‚     â””â”€â”€ Complete Quest â†’ Firestore transaction
                      â”‚           â””â”€â”€ XP/Gold/Stat update â†’ Level-up check
                      â”œâ”€â”€ WorldMapScreen (Map tab)
                      â”‚     â””â”€â”€ Zone tap â†’ BattleScreen
                      â”‚           â”œâ”€â”€ Gemini: opening boss taunt
                      â”‚           â”œâ”€â”€ Turn loop (Attack/Heal/Ultimate)
                      â”‚           â”‚     â”œâ”€â”€ Boss HP < 50% â†’ mid-battle taunt
                      â”‚           â”‚     â””â”€â”€ Dialogue gate (CONTINUE â–¶)
                      â”‚           â””â”€â”€ Victory/Defeat â†’ Gemini narration
                      â”œâ”€â”€ ShopScreen (Shop tab)
                      â”‚     â””â”€â”€ Buy item â†’ Firestore: spend gold, gain stat
                      â””â”€â”€ ProfileScreen (Hero tab)
                            â””â”€â”€ View class, stats, story, XP progress
```

---

## ğŸ’¡ Implementation Details & Innovation

### 1. Dual-Model AI Architecture

The most significant architectural decision was using **two separate Gemini models** for different tasks rather than a single general-purpose model:

```dart
// In AiService constructor:

// Gemini 2.5 Flash â€” accuracy & JSON reliability
_jsonModel = GenerativeModel(
  model: 'gemini-2.5-flash',
  apiKey: apiKey,
  generationConfig: GenerationConfig(
    responseMimeType: 'application/json', // structured JSON output mode
  ),
);

// Gemini 2.5 Flash Lite â€” speed & low latency
_model = GenerativeModel(
  model: 'gemini-2.5-flash-lite',
  apiKey: apiKey,
);
```

**Why this matters:** Quest generation and character creation require reliable JSON parsing â€” a malformed response crashes the onboarding flow. Battle narration calls happen mid-gameplay where response latency directly impacts user experience. Splitting the workload across two models gives us both correctness and responsiveness.

### 2. Retry Logic with Exponential Backoff

All Gemini API calls are wrapped in a `_withRetry()` helper that handles rate limit errors gracefully:

```dart
Future<T> _withRetry<T>(Future<T> Function() fn, {int maxRetries = 3}) async {
  for (int attempt = 0; attempt < maxRetries; attempt++) {
    try {
      return await fn();
    } catch (e) {
      final isQuota = e.toString().contains('quota') ||
          e.toString().contains('429') ||
          e.toString().contains('RESOURCE_EXHAUSTED');

      if (!isQuota || attempt == maxRetries - 1) rethrow;

      int waitSeconds = 10 * (attempt + 1); // 10s â†’ 20s â†’ 30s
      // Parse suggested retry delay from error message if available
      final retryMatch = RegExp(r'retry in (\d+)').firstMatch(e.toString());
      if (retryMatch != null) {
        waitSeconds = int.tryParse(retryMatch.group(1) ?? '') ?? waitSeconds;
        waitSeconds = waitSeconds.clamp(5, 60);
      }
      await Future.delayed(Duration(seconds: waitSeconds));
    }
  }
  throw Exception('AI request failed after $maxRetries retries.');
}
```

This ensures the app degrades gracefully under API quota pressure rather than crashing.

### 3. Dialogue-Gated Battle System

A key UX innovation â€” boss dialogue must complete its typewriter animation before the player can act, creating genuine RPG conversation pacing:

```dart
// State flags in _BattleScreenState:
bool _dialoguePlaying = false;        // typewriter is animating
bool _awaitingPlayerConfirm = false;  // CONTINUE button is showing
String _dialogueSpeaker = 'boss';     // 'boss' | 'player' | 'narrator'

// RpgDialogueBox calls onComplete() when typewriter finishes
void _onDialogueComplete() {
  setState(() {
    _dialoguePlaying = false;
    if (_dialogueSpeaker == 'boss' || _dialogueSpeaker == 'narrator') {
      _awaitingPlayerConfirm = true; // show CONTINUE button
    }
  });
}

// Player taps CONTINUE â†’ action buttons unlock
void _onPlayerConfirm() {
  setState(() {
    _awaitingPlayerConfirm = false;
    if (!_isPlayerTurn && !_battleOver) _isPlayerTurn = true;
  });
}
```

Player action text bypasses the gate (it's their own immediate feedback). Only boss and narrator dialogue requires confirmation.

### 4. Firestore Transactional Quest Completion

Quest completion uses a Firestore transaction to atomically update XP, gold, stat, and check for level-up â€” preventing race conditions if the user taps rapidly:

```dart
await _db.runTransaction((t) async {
  final snap = await t.get(userRef);
  final d = snap.data() as Map<String, dynamic>;
  
  int lvl = d['level'] ?? 1;
  int newXp = (d['xp'] ?? 0) + xp;
  int xpNeed = lvl * 100;

  if (newXp >= xpNeed) {
    lvl++;      // level up
    newXp -= xpNeed;
  }

  t.update(userRef, {
    'xp': newXp,
    'level': lvl,
    'gold': FieldValue.increment(gold),
    statType.toLowerCase(): FieldValue.increment(1),
  });
  t.update(questRef, {'isCompleted': true});
});
```

### 5. Custom Pixel Art via Flutter CustomPainter

All boss art and battle backgrounds are drawn entirely in Flutter using `CustomPainter` â€” no external image assets. This keeps the APK size minimal while giving each zone and boss a unique visual identity. For example, the Giant Slime boss:

```dart
// In boss_painter.dart â€” pure geometry, no images
void _drawSlime(Canvas canvas, Size size, Color color, double sz) {
  final body = Paint()..color = color;
  // Layered ellipses, eyes, highlights, shadows â€” all code
  canvas.drawOval(Rect.fromCenter(...), body);
  // ... shimmer highlights, blinking eyes, drip effects
}
```

### 6. Guildmaster â€” Profile-Aware Quest Generation

The Guildmaster sends the player's complete profile to Gemini, enabling genuinely personalized quest suggestions:

```dart
Future<List<Map<String, dynamic>>> generateGuildmasterQuests({
  required String bio,
  required String mainQuest,
  required String className,
  required int level,
  required int str,
  required int intel,
  required int dex,
}) async {
  final prompt = '''
    You are the Guildmaster. Hero Profile:
    - Class: $className (Level $level)
    - Background: "$bio"
    - Main Quest: "$mainQuest"
    - Stats: STR $str | INT $intel | DEX $dex

    Generate exactly 3 practical, real-world quests for TODAY,
    personalized to their background. Return ONLY a JSON array.
  ''';
  return _safeGenerateList(prompt, fallback);
}
```

A Level 3 hero with low DEX receives different guidance than a Level 8 hero with balanced stats â€” the AI reasons about what is most impactful for this specific player profile.

---

## ğŸ¤– AI Integration Deep Dive

### AI Features Map

| Feature | Model | Input | Output |
|---|---|---|---|
| Character Creation | Gemini 2.5 Flash | Bio + Main Quest text | `{className, story, str, int, dex}` JSON |
| Quest Generation | Gemini 2.5 Flash | Plain English task | `{title, description, xp, gold, statType}` JSON |
| Starter Quests | Gemini 2.5 Flash | Bio + Main Quest | Array of 3 quest JSONs |
| Guildmaster Quests | Gemini 2.5 Flash | Full player profile | Array of 3 personalized quest JSONs |
| Boss Opening Taunt | Gemini 2.5 Flash Lite | Boss name | 1-sentence dramatic string |
| Mid-Battle Taunt | Gemini 2.5 Flash Lite | Boss name | 1-sentence desperate string |
| Battle Outcome | Gemini 2.5 Flash Lite | Class + Boss + Win/Loss | 2-sentence narration string |

### Prompt Engineering Patterns

All structured generation prompts include explicit output constraints to maximize JSON reliability:

```
Return ONLY a JSON object with these exact fields:
{"title": "string", "description": "string", "xp": number, "gold": number, "statType": "STR|INT|DEX"}

No markdown, no code blocks, no preamble. Just the JSON.
```

The `responseMimeType: 'application/json'` config in the model further enforces this. A cleanup step strips any accidental markdown fences:

```dart
final clean = text
    .replaceAll(RegExp(r'```json\s*'), '')
    .replaceAll(RegExp(r'```\s*'), '')
    .trim();
return jsonDecode(clean) as Map<String, dynamic>;
```

### What the App Cannot Do Without AI

| Removed Feature | Impact |
|---|---|
| Character creation | Becomes a preset class picker â€” no personal connection |
| Quest generation | Users manually type tasks with no RPG transformation |
| Battle narration | Static repeated text; no boss personality |
| Guildmaster | Feature entirely non-functional |
| Starter quests | Generic onboarding with no personalization |

---

## ğŸš€ Installation & Setup

### Prerequisites

| Requirement | Version |
|---|---|
| Flutter SDK | â‰¥ 3.2.0 |
| Dart SDK | â‰¥ 3.2.0 |
| Android SDK | API 21+ (Android 5.0+) |
| Java / JDK | 17+ |
| A Firebase project | (see Firebase setup below) |
| A Gemini API key | (see Gemini setup below) |

### Step 1 â€” Clone the Repository

```bash
git clone https://github.com/sutin1215/life-quest-rpg.git
cd life-quest-rpg
```

### Step 2 â€” Install Flutter Dependencies

```bash
flutter pub get
```

### Step 3 â€” Create Your `.env` File

Create a `.env` file in the **project root** (same level as `pubspec.yaml`):

```env
GEMINI_API_KEY=your_gemini_api_key_here
```

> âš ï¸ **Critical:** The `.env` file is already in `.gitignore`. Never commit it to version control â€” your key will be automatically blocked by Google if exposed on GitHub.

### Step 4 â€” Add Firebase Configuration Files

Place your Firebase configuration files in the correct locations:

```
life-quest-rpg/
â”œâ”€â”€ android/
â”‚   â””â”€â”€ app/
â”‚       â””â”€â”€ google-services.json     â† Add this file
â”œâ”€â”€ ios/
â”‚   â””â”€â”€ Runner/
â”‚       â””â”€â”€ GoogleService-Info.plist â† Add this file (iOS only)
â””â”€â”€ ...
```

> These files are excluded from the repository via `.gitignore` for security. See [Firebase Configuration](#-firebase-configuration) below.

### Step 5 â€” Run the App

```bash
# List available devices/emulators
flutter devices

# Run on a connected Android device or emulator
flutter run

# Run in release mode (no debug banner)
flutter run --release
```

### Step 6 â€” First Launch

On first launch the app will:
1. Show the animated splash screen (3.2 seconds)
2. Sign in anonymously via Firebase Auth (no account needed)
3. Check Firestore â€” if no user document exists, navigate to **Character Creation**
4. After character creation, the Fate Weaver generates your class, story, and stats
5. Starter quests are generated and you arrive at the **Quest Board**

---

## ğŸ”¥ Firebase Configuration

### Setting Up a New Firebase Project

1. Go to [Firebase Console](https://console.firebase.google.com)
2. Click **Add project** â†’ name it (e.g., `life-quest-2026`)
3. Disable Google Analytics (not required) â†’ **Create project**

### Enable Authentication

1. In the Firebase Console â†’ **Authentication** â†’ **Get started**
2. **Sign-in method** tab â†’ Enable **Anonymous** â†’ Save

### Enable Firestore

1. **Firestore Database** â†’ **Create database**
2. Choose **Start in test mode** (for development)
3. Select your nearest region â†’ **Enable**

### Firestore Security Rules (Development)

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      match /quests/{questId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
  }
}
```

### Add Android App to Firebase

1. **Project settings** â†’ **Add app** â†’ Android icon
2. Android package name: `com.hackathon.lifequest.life_quest_rpg`
3. Download `google-services.json`
4. Place it at `android/app/google-services.json`

### Using FlutterFire CLI (Recommended)

```bash
# Install FlutterFire CLI
dart pub global activate flutterfire_cli

# Configure â€” this auto-generates lib/firebase_options.dart
flutterfire configure --project=your-firebase-project-id
```

---

## ğŸ¤– Gemini API Configuration

### Getting Your API Key

1. Go to [Google AI Studio](https://aistudio.google.com)
2. Click **Get API key** â†’ **Create API key**
3. Copy the key (starts with `AIzaSy...`)

### Free Tier Limits

| Model | Requests/Day | Rate Limit |
|---|---|---|
| `gemini-2.5-flash` | 1,500 | 15 RPM |
| `gemini-2.5-flash-lite` | 1,500 | 30 RPM |

The app includes retry logic with exponential backoff to handle rate limit errors automatically.

### Securing Your Key

- Store your key **only** in `.env` at the project root
- Confirm `.env` is in your `.gitignore` (it is by default in this repo)
- Never hardcode it in any Dart file
- If accidentally committed: immediately rotate the key in Google AI Studio

---

## ğŸ“ Project Structure

```
lib/
â”œâ”€â”€ main.dart                    # App entry, Firebase init, AuthWrapper
â”œâ”€â”€ firebase_options.dart        # Auto-generated by FlutterFire CLI
â”‚
â”œâ”€â”€ models/
â”‚   â””â”€â”€ quest_model.dart         # Quest data class
â”‚
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ splash_screen.dart       # Animated title screen (3.2s, 60 stars)
â”‚   â”œâ”€â”€ character_creation_screen.dart  # Bio + Main Quest input â†’ Gemini
â”‚   â”œâ”€â”€ profile_screen.dart      # Hero stats, story, class display
â”‚   â”œâ”€â”€ home_screen.dart         # Bottom nav + QuestBoard + Guildmaster
â”‚   â”œâ”€â”€ world_map_screen.dart    # Zone selection with animated markers
â”‚   â”œâ”€â”€ battle_screen.dart       # Turn-based combat with dialogue gate
â”‚   â””â”€â”€ shop_screen.dart         # Goblin Market â€” spend gold for stats
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ai_service.dart          # All Gemini API calls (2 models, retry logic)
â”‚   â””â”€â”€ database_service.dart    # All Firestore operations (streams + writes)
â”‚
â”œâ”€â”€ theme/
â”‚   â””â”€â”€ rpg_theme.dart           # Central color palette, text styles, decorations
â”‚
â””â”€â”€ widgets/
    â”œâ”€â”€ rpg_dialogue_box.dart    # Typewriter animation widget with onComplete callback
    â”œâ”€â”€ boss_painter.dart        # CustomPainter pixel art for all 4 bosses
    â”œâ”€â”€ battle_backgrounds.dart  # CustomPainter zone backgrounds (4 themes)
    â”œâ”€â”€ floating_reward.dart     # Animated +XP / +Gold popup overlay
    â””â”€â”€ glowing_stat_badge.dart  # Pulsing STR/INT/DEX stat display widgets
```

---

## ğŸ§± Challenges Faced

### Challenge 1: Gemini Model Deprecation Mid-Development

**What happened:** During active development, the `gemini-2.5-flash-lite-preview-06-17` preview model was retired. The app compiled without errors but crashed at runtime with:

```
[ERROR] Unhandled Exception: models/gemini-2.5-flash-lite-preview-06-17 
is not found for API version v1beta, or is not supported for generateContent.
```

**Why it was hard:** The error occurred deep in an async call stack (`generateBattleResult`), was not surfaced at compile time, and initially appeared to be a network or Firebase issue. We spent time debugging Firebase initialization before isolating the actual cause.

**Resolution:** Updated the model string to `gemini-2.5-flash-lite` (the stable release). Added model version documentation in comments to make future deprecations easier to catch. The lesson: always check [Google AI Studio's model availability](https://ai.google.dev/gemini-api/docs/models/gemini) before deployment.

---

### Challenge 2: Firebase Duplicate-App Crash on Hot Restart

**What happened:** Flutter's hot restart re-executes `main()` without fully terminating the app process. Calling `Firebase.initializeApp()` a second time on an already-initialized instance throws:

```
[ERROR] [core/duplicate-app] A Firebase App named "[DEFAULT]" already exists
```

**Resolution:** Added an `isEmpty` guard before initialization:

```dart
if (Firebase.apps.isEmpty) {
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
}
```

Also wrapped `dotenv.load()` in a try-catch to prevent cascading initialization failures if `.env` is missing.

---

### Challenge 3: BuildContext Across Async Gaps (Lint Warnings)

**What happened:** Flutter's linter flagged `ScaffoldMessenger.of(context)` calls that appeared after `await` statements â€” a legitimate warning since the widget may have unmounted during the async gap.

**Resolution:** Captured the messenger reference *before* the `await`:

```dart
// âœ… Correct â€” capture before async gap
final messenger = ScaffoldMessenger.of(context);
bool success = await db.buyItem(...);
if (!context.mounted) return;
messenger.showSnackBar(...);
```

For `State` methods using `mounted` checks, split combined conditions:

```dart
// âœ… Correct â€” separate guards
if (afterLvl <= beforeLvl) return;
if (!mounted) return;
showDialog(context: context, ...);
```

---

### Challenge 4: Race Condition in Quest Completion

**What happened:** Rapid tapping of the quest completion button could trigger multiple Firestore writes simultaneously, causing XP to be added multiple times or the level-up check to fire incorrectly.

**Resolution:** Used Firestore's atomic transaction API to read the current state and write the update in a single operation, making concurrent calls safe:

```dart
await _db.runTransaction((t) async {
  final snap = await t.get(userRef);
  // compute new values from current state
  t.update(userRef, { /* new values */ });
  t.update(questRef, {'isCompleted': true});
});
```

---

## ğŸ—º Future Roadmap

### Phase 1: 0â€“6 Months â€” Stabilise & Grow
- [ ] Deploy to Google Play Store (Android) and Apple App Store (iOS)
- [ ] Add Google account sign-in for cross-device progress sync
- [ ] Implement Firebase Analytics for feature engagement tracking
- [ ] Expand from 4 to 12 boss zones (academic, fitness, social domains)
- [ ] Add weekly quest streaks and daily login rewards

### Phase 2: 6â€“12 Months â€” Community Layer
- [ ] **Guild System** â€” Form study/accountability groups; cooperative boss raids where each member's quest completions deal collective damage
- [ ] **Weekly Challenges** â€” Gemini-generated community quests with leaderboards
- [ ] University pilot programme â€” institution-customized zones (e.g., "The Finals Dungeon" during exam season)
- [ ] Push notifications for quest reminders and level-up celebrations

### Phase 3: 12+ Months â€” Platform Expansion
- [ ] **B2B Corporate Wellness** â€” Custom-branded deployments for HR teams with employee wellness quest templates
- [ ] **Wearable Integration** â€” Auto-generate STR quests from Google Fit / Apple Health data
- [ ] **SEA Localization** â€” Bahasa Melayu, Bahasa Indonesia, Thai, Vietnamese
- [ ] **Multiplayer Guilds** â€” Real-time guild chat, shared quest boards, and guild wars

---

## ğŸ‘¥ Team

**Team Name:** *(fill in)*

| Name | Role |
|---|---|
| *(fill in)* | *(fill in)* |
| *(fill in)* | *(fill in)* |

**Institution:** *(fill in)*  
**Competition:** KitaHack 2026  
**SDG Target:** SDG 3.4 â€” Mental Health and Well-being

---

<div align="center">

**Built with â¤ï¸ for KitaHack 2026**

*"Every quest completed is a step toward a better you."*

</div>